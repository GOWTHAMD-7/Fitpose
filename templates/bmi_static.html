<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI & Body Composition Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Dashboard-matching white theme for bmi_static.html */
        :root {
            --primary-blue: #3f51b5;
            --primary-blue-dark: #35449f;
            --page-bg: #f4f7f9;
            --card-bg: #ffffff;
            --muted: #6c757d;
            --card-border: #e9eef6;
        }

        body {
            background-color: var(--page-bg);
            color: #222;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 36px auto;
            padding: 0 16px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(63,81,181,0.06);
            overflow: hidden;
            border: 1px solid var(--card-border);
        }

        .card-header {
            background-color: rgba(255,255,255,0.98);
            padding: 24px 28px;
            border-bottom: 1px solid var(--card-border);
        }

        h1 {
            text-align: center;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 6px;
            color: var(--primary-blue);
        }

        .subtitle {
            text-align: center;
            color: var(--muted);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .tab-system .nav-tabs {
            border: none;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-system .nav-link {
            background: transparent;
            border: none;
            color: var(--muted);
            font-weight: 500;
            padding: 8px 18px;
            border-radius: 30px;
            transition: all 0.2s ease;
            margin: 0 6px;
        }

        .tab-system .nav-link.active {
            background-color: var(--primary-blue);
            color: #fff;
            box-shadow: 0 6px 18px rgba(63,81,181,0.12);
        }

        .input-group { margin-bottom: 14px; }
        .input-group label { font-size: 0.95rem; color: var(--muted); margin-bottom: 6px; display:block; font-weight:500; }

        .input-group input, .input-group select {
            width: 100%; padding: 12px 14px; border: 1px solid #d7dee9; background:#fff; color:#222; border-radius:8px; font-size:1rem; transition:all .12s;
        }

        .input-group input::placeholder { color:#9aa3ad; }

        .input-group input:focus, .input-group select:focus { outline:none; border-color:var(--primary-blue); box-shadow:0 0 10px rgba(63,81,181,0.10); }

        .btn-primary { background: linear-gradient(90deg,var(--primary-blue),var(--primary-blue-dark)); border:none; width:100%; padding:12px; border-radius:10px; font-weight:600; color:#fff; box-shadow:0 6px 18px rgba(63,81,181,0.08); }
        .btn-primary:hover { transform: translateY(-1px); box-shadow:0 8px 22px rgba(63,81,181,0.10); }

        .result-card { background: #fff; border-radius:12px; padding:18px; margin-top:20px; text-align:center; border:1px solid var(--card-border); display:none; color:#111; }
        .result-value { font-size:2rem; font-weight:700; color:var(--primary-blue); margin:8px 0; }
        .result-label { font-weight:600; color:var(--muted); font-size:1rem; }

        .category { display:inline-block; padding:8px 14px; border-radius:18px; font-weight:600; margin:10px 0; text-transform:uppercase; font-size:0.85rem; }
        .category-underweight{ background:#3182ce; color:#fff } .category-normal{ background:#38a169;color:#fff } .category-overweight{ background:#dd6b20;color:#fff } .category-obese{ background:#e53e3e;color:#fff }

        .back-link { text-align:center; margin:18px 0; }
        .back-link a { color:var(--primary-blue); text-decoration:none; font-weight:600; padding:8px 16px; border-radius:20px; background:#f1f5fb }
        .back-link a:hover{ color:var(--primary-blue-dark); }

        .form-card { padding: 28px; }
        .bmi-chart { width:100%; height:300px; margin:20px 0 }
        .metric-card { background:#f8fafc; border-radius:12px; padding:12px; margin-bottom:12px; border:1px solid #eef3f8 }
        .metric-card h5{ font-size:1rem; font-weight:600; color:var(--primary-blue); margin-bottom:10px }

        .health-tip{ background:#f1f6f9; padding:12px; border-radius:8px; margin-top:12px; border-left:4px solid var(--primary-blue) }

        .progress-bar-container{ width:100%; height:20px; background:#eef3f8; border-radius:10px; margin:12px 0; position:relative; }
        .progress-bar{ height:100%; background:linear-gradient(90deg,#3182ce,#38a169,#dd6b20,#e53e3e); width:0; transition:width 1s; border-radius:10px }

        .marker{ position:absolute; top:-10px; width:4px; height:40px; background:#222; transform:translateX(-50%); z-index:2 }
        .marker-label{ position:absolute; top:-30px; transform:translateX(-50%); font-size:0.75rem; color:var(--muted) }

        @media (max-width:768px){ .container{ padding:0 12px } .card{ border-radius:12px } .form-card{ padding:18px } h1{ font-size:1.6rem } .btn-primary{ padding:12px; font-size:1rem } .result-value{ font-size:1.5rem } }

        .error{ color:#d9534f; font-size:0.95rem; text-align:center; margin-top:10px; background:#fff5f5; padding:10px; border-radius:8px; border:1px solid rgba(217,83,79,0.12); display:none }
    </style>
</head>

<body>
    <div class="container">
        <div class="card">
            <div class="card-header">
                <h1>BMI & Body Composition Calculator</h1>
                <p class="subtitle">Track your health metrics and get personalized recommendations</p>
            </div>
            
            <div class="form-card">
                <div class="tab-system">
                    <ul class="nav nav-tabs" id="bodyMetricTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="bmi-tab" data-bs-toggle="tab" data-bs-target="#bmi-panel" type="button" role="tab" aria-controls="bmi-panel" aria-selected="true">BMI Calculator</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="body-fat-tab" data-bs-toggle="tab" data-bs-target="#body-fat-panel" type="button" role="tab" aria-controls="body-fat-panel" aria-selected="false">Body Fat %</button>
                        </li>
                    </ul>
                    
                    <div class="tab-content" id="bodyMetricTabContent">
                        <!-- BMI Calculator Tab -->
                        <div class="tab-pane fade show active" id="bmi-panel" role="tabpanel" aria-labelledby="bmi-tab">
                            <div class="row">
                                <div class="col-md-6">
                                    <form id="bmiForm" onsubmit="return calculateBMI(event)">
                                        <div class="input-group">
                                            <label for="weight">Weight (kg):</label>
                                            <input type="number" id="weight" name="weight" placeholder="Enter your weight" step="0.1" min="20" max="300" required>
                                        </div>
                                        
                                        <div class="input-group">
                                            <label for="height">Height (cm):</label>
                                            <input type="number" id="height" name="height" placeholder="Enter your height" step="0.1" min="100" max="250" required>
                                        </div>
                                        
                                        <div class="input-group">
                                            <label for="age">Age (years):</label>
                                            <input type="number" id="age" name="age" placeholder="Enter your age" min="10" max="120" required>
                                        </div>
                                        
                                        <div class="input-group">
                                            <label for="gender">Gender:</label>
                                            <select id="gender" name="gender" required>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                            </select>
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">Calculate BMI</button>
                                    </form>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="bmi-info">
                                        <h5>BMI Categories:</h5>
                                        <div class="metric-card">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span>Underweight</span>
                                                <span>&lt; 18.5</span>
                                            </div>
                                            <div class="progress-bar-container" style="background-color: rgba(49, 130, 206, 0.2);">
                                                <div class="progress-bar" style="width: 18.5%; background-color: #3182ce;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span>Normal</span>
                                                <span>18.5 - 24.9</span>
                                            </div>
                                            <div class="progress-bar-container" style="background-color: rgba(56, 161, 105, 0.2);">
                                                <div class="progress-bar" style="width: 24.9%; background-color: #38a169;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span>Overweight</span>
                                                <span>25.0 - 29.9</span>
                                            </div>
                                            <div class="progress-bar-container" style="background-color: rgba(221, 107, 32, 0.2);">
                                                <div class="progress-bar" style="width: 29.9%; background-color: #dd6b20;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="metric-card">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span>Obese</span>
                                                <span>≥ 30.0</span>
                                            </div>
                                            <div class="progress-bar-container" style="background-color: rgba(229, 62, 62, 0.2);">
                                                <div class="progress-bar" style="width: 40%; background-color: #e53e3e;"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="health-tip">
                                            <p><strong>Note:</strong> BMI is a screening tool, not a diagnostic tool. Factors such as muscle mass, bone density, and distribution of fat aren't considered.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- BMI Result Section -->
                            <div id="bmiResultSection" class="result-card">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3 class="mb-4">Your BMI Results</h3>
                                        <div class="result-value" id="bmiValue">--</div>
                                        <div id="bmiCategory" class="category">--</div>
                                        <p id="idealWeight" class="mt-3"></p>
                                        
                                        <div class="progress-bar-container mt-4">
                                            <div id="bmiProgressBar" class="progress-bar"></div>
                                            <div class="marker" style="left: 18.5%">
                                                <div class="marker-label">18.5</div>
                                            </div>
                                            <div class="marker" style="left: 25%">
                                                <div class="marker-label">25</div>
                                            </div>
                                            <div class="marker" style="left: 30%">
                                                <div class="marker-label">30</div>
                                            </div>
                                            <div id="yourBmiMarker" class="marker" style="left: 50%; background-color: #38b2ac; width: 6px;">
                                                <div class="marker-label" style="color: #38b2ac; font-weight: bold;">You</div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <canvas id="bmiGaugeChart"></canvas>
                                        <div class="interpretations">
                                            <h5 class="mb-3">What Your BMI Means:</h5>
                                            <div id="bmiInterpretation" class="health-tip"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Body Fat Calculator Tab -->
                        <div class="tab-pane fade" id="body-fat-panel" role="tabpanel" aria-labelledby="body-fat-tab">
                            <div class="row">
                                <div class="col-md-6">
                                    <form id="bodyFatForm" onsubmit="return calculateBodyFat(event)">
                                        <div class="input-group">
                                            <label for="bf_weight">Weight (kg):</label>
                                            <input type="number" id="bf_weight" name="bf_weight" placeholder="Enter your weight" step="0.1" min="20" max="300" required>
                                        </div>
                                        
                                        <div class="input-group">
                                            <label for="bf_height">Height (cm):</label>
                                            <input type="number" id="bf_height" name="bf_height" placeholder="Enter your height" step="0.1" min="100" max="250" required>
                                        </div>
                                        
                                        <div class="input-group">
                                            <label for="bf_gender">Gender:</label>
                                            <select id="bf_gender" name="bf_gender" required>
                                                <option value="male">Male</option>
                                                <option value="female">Female</option>
                                            </select>
                                        </div>
                                        
                                        <div class="input-group">
                                            <label for="waist">Waist Circumference (cm):</label>
                                            <input type="number" id="waist" name="waist" placeholder="Measure around your waist at the navel" step="0.1" required>
                                        </div>
                                        
                                        <div class="input-group">
                                            <label for="neck">Neck Circumference (cm):</label>
                                            <input type="number" id="neck" name="neck" placeholder="Measure around the base of your neck" step="0.1" required>
                                        </div>
                                        
                                        <div class="input-group" id="hipGroup" style="display: none;">
                                            <label for="hip">Hip Circumference (cm):</label>
                                            <input type="number" id="hip" name="hip" placeholder="Measure around the widest part of your hips" step="0.1">
                                        </div>
                                        
                                        <button type="submit" class="btn btn-primary">Calculate Body Fat</button>
                                    </form>
                                </div>
                                
                                <div class="col-md-6">
                                    <h5>Body Fat Percentage Ranges</h5>
                                    
                                    <div class="metric-card">
                                        <h6>For Men:</h6>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Essential Fat: 2-5%</span>
                                            <span>Athletes: 6-13%</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Fitness: 14-17%</span>
                                            <span>Average: 18-24%</span>
                                        </div>
                                        <div>Obese: 25%+</div>
                                    </div>
                                    
                                    <div class="metric-card mt-3">
                                        <h6>For Women:</h6>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Essential Fat: 10-13%</span>
                                            <span>Athletes: 14-20%</span>
                                        </div>
                                        <div class="d-flex justify-content-between mb-2">
                                            <span>Fitness: 21-24%</span>
                                            <span>Average: 25-31%</span>
                                        </div>
                                        <div>Obese: 32%+</div>
                                    </div>
                                    
                                    <div class="health-tip mt-4">
                                        <p><strong>About the formula:</strong> This calculator uses the U.S. Navy method for estimating body fat percentage based on neck, waist, and hip (for women) measurements.</p>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Body Fat Result Section -->
                            <div id="bodyFatResultSection" class="result-card">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h3 class="mb-4">Your Body Fat Results</h3>
                                        <div class="result-value" id="bodyFatValue">--</div>
                                        <div id="bodyFatCategory" class="category">--</div>
                                        
                                        <div class="mt-4">
                                            <div class="d-flex justify-content-between mb-1">
                                                <span>Fat Mass:</span>
                                                <span id="fatMass">-- kg</span>
                                            </div>
                                            <div class="d-flex justify-content-between">
                                                <span>Lean Mass:</span>
                                                <span id="leanMass">-- kg</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <canvas id="bodyFatGaugeChart"></canvas>
                                        <div class="interpretations">
                                            <h5 class="mb-3">What Your Body Fat % Means:</h5>
                                            <div id="bodyFatInterpretation" class="health-tip"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Error Message -->
                <div id="errorMessage" class="error">Please fill in all required fields with valid measurements.</div>
                
                <!-- Back to Home Link -->
                <div class="back-link">
                    <a href="/">← Back to Home</a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Handle displaying hip measurement field based on gender selection
        document.getElementById('bf_gender').addEventListener('change', function() {
            const gender = this.value;
            const hipGroup = document.getElementById('hipGroup');
            hipGroup.style.display = gender === 'female' ? 'block' : 'none';
        });
        
        // Initialize hip field visibility on load
        window.addEventListener('DOMContentLoaded', function() {
            const gender = document.getElementById('bf_gender').value;
            const hipGroup = document.getElementById('hipGroup');
            hipGroup.style.display = gender === 'female' ? 'block' : 'none';
        });
        
        // BMI Calculator function
        function calculateBMI(event) {
            event.preventDefault();
            
            // Get form values
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value) / 100; // Convert cm to meters
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            
            // Validate inputs
            if (isNaN(weight) || isNaN(height) || isNaN(age) || height <= 0 || weight <= 0) {
                document.getElementById('errorMessage').style.display = 'block';
                return false;
            }
            document.getElementById('errorMessage').style.display = 'none';
            
            // Calculate BMI
            const bmi = weight / (height * height);
            
            // Calculate ideal weight range (BMI between 18.5 and 24.9)
            const minIdealWeight = (18.5 * height * height).toFixed(1);
            const maxIdealWeight = (24.9 * height * height).toFixed(1);
            
            // Update results
            document.getElementById('bmiValue').textContent = bmi.toFixed(1);
            document.getElementById('idealWeight').textContent = `Ideal weight range: ${minIdealWeight} - ${maxIdealWeight} kg`;
            
            // Update BMI category
            let category, categoryClass, interpretation;
            if (bmi < 18.5) {
                category = 'UNDERWEIGHT';
                categoryClass = 'category-underweight';
                interpretation = `<p>Your BMI of ${bmi.toFixed(1)} indicates you're underweight. This may suggest insufficient caloric intake or underlying health issues. Consider:</p>
                <ul>
                    <li>Increasing your daily calorie intake</li>
                    <li>Adding strength training to build muscle mass</li>
                    <li>Consulting with a healthcare provider to rule out medical conditions</li>
                </ul>`;
            } else if (bmi >= 18.5 && bmi < 25) {
                category = 'NORMAL WEIGHT';
                categoryClass = 'category-normal';
                interpretation = `<p>Great job! Your BMI of ${bmi.toFixed(1)} falls within the normal/healthy weight range. To maintain this:</p>
                <ul>
                    <li>Continue balanced nutrition with adequate protein, complex carbs, and healthy fats</li>
                    <li>Aim for 150+ minutes of moderate exercise weekly</li>
                    <li>Include both cardio and strength training in your routine</li>
                </ul>`;
            } else if (bmi >= 25 && bmi < 30) {
                category = 'OVERWEIGHT';
                categoryClass = 'category-overweight';
                interpretation = `<p>Your BMI of ${bmi.toFixed(1)} places you in the overweight category. This may increase your risk for certain health conditions. Consider:</p>
                <ul>
                    <li>Creating a moderate calorie deficit (250-500 calories/day)</li>
                    <li>Increasing physical activity with both cardio and strength training</li>
                    <li>Focusing on nutrient-dense whole foods</li>
                    <li>Setting a realistic goal of losing 0.5-1kg per week</li>
                </ul>`;
            } else {
                category = 'OBESE';
                categoryClass = 'category-obese';
                interpretation = `<p>Your BMI of ${bmi.toFixed(1)} indicates obesity, which increases risk for various health conditions. It's recommended to:</p>
                <ul>
                    <li>Consult with healthcare providers for personalized guidance</li>
                    <li>Focus on sustainable lifestyle changes rather than quick fixes</li>
                    <li>Begin with moderate physical activity that's gentle on joints</li>
                    <li>Consider working with a registered dietitian</li>
                </ul>`;
            }
            
            document.getElementById('bmiCategory').textContent = category;
            document.getElementById('bmiCategory').className = `category ${categoryClass}`;
            document.getElementById('bmiInterpretation').innerHTML = interpretation;
            
            // Update progress bar position
            const progressPercent = Math.min(Math.max(bmi, 10), 40) * 2.5; // Scale to fit bar (10-40 BMI)
            document.getElementById('bmiProgressBar').style.width = `${progressPercent}%`;
            document.getElementById('yourBmiMarker').style.left = `${progressPercent}%`;
            
            // Show results section
            document.getElementById('bmiResultSection').style.display = 'block';
            
            // Create gauge chart
            createBmiGaugeChart(bmi);
            
            return false;
        }
        
        // Body Fat Calculator function
        function calculateBodyFat(event) {
            event.preventDefault();
            
            // Get form values
            const weight = parseFloat(document.getElementById('bf_weight').value);
            const height = parseFloat(document.getElementById('bf_height').value);
            const gender = document.getElementById('bf_gender').value;
            const waist = parseFloat(document.getElementById('waist').value);
            const neck = parseFloat(document.getElementById('neck').value);
            const hip = gender === 'female' ? parseFloat(document.getElementById('hip').value) : 0;
            
            // Validate inputs
            if (isNaN(weight) || isNaN(height) || isNaN(waist) || isNaN(neck) || 
                (gender === 'female' && isNaN(hip))) {
                document.getElementById('errorMessage').style.display = 'block';
                return false;
            }
            document.getElementById('errorMessage').style.display = 'none';
            
            // Calculate Body Fat Percentage using the US Navy formula
            let bodyFatPercentage;
            if (gender === 'male') {
                bodyFatPercentage = 495 / (1.0324 - 0.19077 * Math.log10(waist - neck) + 0.15456 * Math.log10(height)) - 450;
            } else {
                bodyFatPercentage = 495 / (1.29579 - 0.35004 * Math.log10(waist + hip - neck) + 0.22100 * Math.log10(height)) - 450;
            }
            
            // Calculate fat mass and lean mass
            const fatMass = (weight * bodyFatPercentage / 100).toFixed(1);
            const leanMass = (weight - fatMass).toFixed(1);
            
            // Update results
            document.getElementById('bodyFatValue').textContent = bodyFatPercentage.toFixed(1) + '%';
            document.getElementById('fatMass').textContent = `${fatMass} kg`;
            document.getElementById('leanMass').textContent = `${leanMass} kg`;
            
            // Determine body fat category
            let category, categoryClass, interpretation;
            if (gender === 'male') {
                if (bodyFatPercentage < 6) {
                    category = 'ESSENTIAL FAT';
                    categoryClass = 'category-underweight';
                    interpretation = "<p>You're at the essential fat level, which is the minimum needed for basic physiological functions. This level is typically maintained only by elite athletes and may be difficult to sustain long-term.</p>";
                } else if (bodyFatPercentage >= 6 && bodyFatPercentage < 14) {
                    category = 'ATHLETIC';
                    categoryClass = 'category-normal';
                    interpretation = "<p>You're in the athletic range of body fat, typical of competitive athletes. This level provides excellent muscle definition but requires dedicated training and nutrition.</p>";
                } else if (bodyFatPercentage >= 14 && bodyFatPercentage < 18) {
                    category = 'FITNESS';
                    categoryClass = 'category-normal';
                    interpretation = "<p>You have a fitness level of body fat - lean and defined but more sustainable than the athletic range. This is an excellent balance of health and aesthetics.</p>";
                } else if (bodyFatPercentage >= 18 && bodyFatPercentage < 25) {
                    category = 'AVERAGE';
                    categoryClass = 'category-overweight';
                    interpretation = "<p>Your body fat percentage is in the average range for men. While not concerning for health, reducing body fat slightly could improve athletic performance and metabolic health.</p>";
                } else {
                    category = 'OBESE';
                    categoryClass = 'category-obese';
                    interpretation = "<p>Your body fat percentage is in the obese range, which may increase health risks. Focus on gradual fat loss through consistent exercise and a moderate calorie deficit.</p>";
                }
            } else { // Female
                if (bodyFatPercentage < 14) {
                    category = 'ESSENTIAL FAT';
                    categoryClass = 'category-underweight';
                    interpretation = "<p>You're at the essential fat level for women, which is the minimum needed for hormonal and reproductive health. This level is typically only maintained by elite female athletes.</p>";
                } else if (bodyFatPercentage >= 14 && bodyFatPercentage < 21) {
                    category = 'ATHLETIC';
                    categoryClass = 'category-normal';
                    interpretation = "<p>You're in the athletic range of body fat, typical of competitive female athletes. This level provides excellent muscle definition but requires dedicated training and nutrition.</p>";
                } else if (bodyFatPercentage >= 21 && bodyFatPercentage < 25) {
                    category = 'FITNESS';
                    categoryClass = 'category-normal';
                    interpretation = "<p>You have a fitness level of body fat - lean and defined but more sustainable than the athletic range. This is an excellent balance of health and aesthetics for women.</p>";
                } else if (bodyFatPercentage >= 25 && bodyFatPercentage < 32) {
                    category = 'AVERAGE';
                    categoryClass = 'category-overweight';
                    interpretation = "<p>Your body fat percentage is in the average range for women. While not concerning for health, reducing body fat slightly could improve athletic performance and metabolic health.</p>";
                } else {
                    category = 'OBESE';
                    categoryClass = 'category-obese';
                    interpretation = "<p>Your body fat percentage is in the obese range, which may increase health risks. Focus on gradual fat loss through consistent exercise and a moderate calorie deficit.</p>";
                }
            }
            
            document.getElementById('bodyFatCategory').textContent = category;
            document.getElementById('bodyFatCategory').className = `category ${categoryClass}`;
            document.getElementById('bodyFatInterpretation').innerHTML = interpretation;
            
            // Show results section
            document.getElementById('bodyFatResultSection').style.display = 'block';
            
            // Create gauge chart for body fat
            createBodyFatGaugeChart(bodyFatPercentage, gender);
            
            return false;
        }
        
        // Create BMI gauge chart
        function createBmiGaugeChart(bmiValue) {
            const ctx = document.getElementById('bmiGaugeChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.bmiChart) {
                window.bmiChart.destroy();
            }
            
            // Data setup
            const data = {
                labels: ['Underweight', 'Normal', 'Overweight', 'Obese'],
                datasets: [{
                    data: [18.5, 6.5, 5, 10],
                    backgroundColor: ['#3182ce', '#38a169', '#dd6b20', '#e53e3e'],
                    borderWidth: 0
                }]
            };
            
            // Configuration
            const config = {
                type: 'doughnut',
                data: data,
                options: {
                    circumference: 180,
                    rotation: 270,
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        tooltip: {
                            enabled: false
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: '#a0aec0',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'BMI Scale',
                            color: '#e2e8f0',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'bmiNeedle',
                    afterDatasetDraw(chart) {
                        const { ctx, data, chartArea, scales } = chart;
                        
                        ctx.save();
                        
                        // Calculate pointer position
                        const centerX = (chartArea.left + chartArea.right) / 2;
                        const centerY = chartArea.bottom;
                        const radius = Math.min(chartArea.right - chartArea.left, chartArea.bottom - chartArea.top) / 2;
                        
                        // Map BMI to angle (0-40 BMI range to 0-180 degrees)
                        const bmi = Math.min(Math.max(bmiValue, 10), 40);
                        const angle = (bmi - 10) / 30 * Math.PI;
                        
                        // Draw pointer
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY);
                        ctx.lineTo(
                            centerX + radius * 0.8 * Math.cos(angle),
                            centerY - radius * 0.8 * Math.sin(angle)
                        );
                        ctx.strokeStyle = '#38b2ac';
                        ctx.lineWidth = 4;
                        ctx.stroke();
                        
                        // Draw circle at base of needle
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, 8, 0, 2 * Math.PI);
                        ctx.fillStyle = '#38b2ac';
                        ctx.fill();
                        
                        // Add BMI value text
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillStyle = '#e2e8f0';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText('Your BMI', centerX, centerY - 40);
                        ctx.font = 'bold 24px Arial';
                        ctx.fillText(bmiValue.toFixed(1), centerX, centerY - 15);
                        
                        ctx.restore();
                    }
                }]
            };
            
            // Create the chart
            window.bmiChart = new Chart(ctx, config);
        }
        
        // Create Body Fat gauge chart
        function createBodyFatGaugeChart(bodyFatPercentage, gender) {
            const ctx = document.getElementById('bodyFatGaugeChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (window.bodyFatChart) {
                window.bodyFatChart.destroy();
            }
            
            // Data setup - different ranges for male and female
            let data;
            if (gender === 'male') {
                data = {
                    labels: ['Essential (2-5%)', 'Athletic (6-13%)', 'Fitness (14-17%)', 'Average (18-24%)', 'Obese (25%+)'],
                    datasets: [{
                        data: [5, 8, 4, 7, 16],
                        backgroundColor: ['#4299e1', '#3182ce', '#38a169', '#dd6b20', '#e53e3e'],
                        borderWidth: 0
                    }]
                };
            } else { // female
                data = {
                    labels: ['Essential (10-13%)', 'Athletic (14-20%)', 'Fitness (21-24%)', 'Average (25-31%)', 'Obese (32%+)'],
                    datasets: [{
                        data: [3, 7, 4, 7, 19],
                        backgroundColor: ['#4299e1', '#3182ce', '#38a169', '#dd6b20', '#e53e3e'],
                        borderWidth: 0
                    }]
                };
            }
            
            // Configuration
            const config = {
                type: 'doughnut',
                data: data,
                options: {
                    circumference: 180,
                    rotation: 270,
                    cutout: '70%',
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        tooltip: {
                            enabled: false
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: '#a0aec0',
                                font: {
                                    size: 10
                                },
                                boxWidth: 12
                            }
                        },
                        title: {
                            display: true,
                            text: 'Body Fat Scale',
                            color: '#e2e8f0',
                            font: {
                                size: 16,
                                weight: 'bold'
                            }
                        }
                    }
                },
                plugins: [{
                    id: 'bodyFatNeedle',
                    afterDatasetDraw(chart) {
                        const { ctx, data, chartArea } = chart;
                        
                        ctx.save();
                        
                        // Calculate pointer position
                        const centerX = (chartArea.left + chartArea.right) / 2;
                        const centerY = chartArea.bottom;
                        const radius = Math.min(chartArea.right - chartArea.left, chartArea.bottom - chartArea.top) / 2;
                        
                        // Map body fat % to angle
                        // For men: 2-40% maps to 0-180 degrees
                        // For women: 10-50% maps to 0-180 degrees
                        const minValue = gender === 'male' ? 2 : 10;
                        const maxValue = gender === 'male' ? 40 : 50;
                        const range = maxValue - minValue;
                        
                        const bodyFat = Math.min(Math.max(bodyFatPercentage, minValue), maxValue);
                        const angle = (bodyFat - minValue) / range * Math.PI;
                        
                        // Draw pointer
                        ctx.beginPath();
                        ctx.moveTo(centerX, centerY);
                        ctx.lineTo(
                            centerX + radius * 0.8 * Math.cos(angle),
                            centerY - radius * 0.8 * Math.sin(angle)
                        );
                        ctx.strokeStyle = '#38b2ac';
                        ctx.lineWidth = 4;
                        ctx.stroke();
                        
                        // Draw circle at base of needle
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, 8, 0, 2 * Math.PI);
                        ctx.fillStyle = '#38b2ac';
                        ctx.fill();
                        
                        // Add body fat % value text
                        ctx.textAlign = 'center';
                        ctx.textBaseline = 'middle';
                        ctx.fillStyle = '#e2e8f0';
                        ctx.font = 'bold 16px Arial';
                        ctx.fillText('Your Body Fat %', centerX, centerY - 40);
                        ctx.font = 'bold 24px Arial';
                        ctx.fillText(bodyFatPercentage.toFixed(1) + '%', centerX, centerY - 15);
                        
                        ctx.restore();
                    }
                }]
            };
            
            // Create the chart
            window.bodyFatChart = new Chart(ctx, config);
        }
    </script>
</body>

</html>
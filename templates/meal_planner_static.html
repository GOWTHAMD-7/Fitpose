<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Meal Planner & Macro Calculator</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #1f2937; /* Dark background */
            color: #d1d5db; /* Light text */
            font-family: 'Roboto', Arial, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 40px;
            padding-bottom: 40px;
        }

        .container {
            width: 100%;
            max-width: 700px;
            padding: 30px 40px;
            background-color: #2d3748; /* Card background */
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }

        h1 {
            color: #34a853; /* Accent green */
            font-size: 2.4rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
        }

        .form-label {
            color: #a0aec0;
            font-weight: 500;
        }
        .form-control, .form-select {
            background-color: #1a202c;
            color: #d1d5db;
            border: 1px solid #4a5568;
            border-radius: 8px;
            padding: 12px;
        }

        .form-control:focus, .form-select:focus {
            border-color: #34a853;
            box-shadow: 0 0 8px rgba(52, 168, 83, 0.6);
            outline: none;
        }

        .btn-primary {
            background-color: #16a085;
            border: none;
            padding: 12px 25px;
            font-weight: 600;
            font-size: 1.1rem;
            border-radius: 10px;
            transition: background-color 0.3s ease;
        }

        .btn-primary:hover {
            background-color: #138e75;
        }

        .result {
            margin-top: 30px;
            font-size: 1.3rem;
            font-weight: 600;
            background-color: #1c2733;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 6px 12px rgba(22, 160, 133, 0.5);
        }

        canvas {
            margin-top: 20px;
            max-width: 400px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 576px) {
            .container {
                padding: 20px 20px;
            }
            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Macro Calculator & Meal Planner</h1>

        <form id="macroForm">
            <div class="mb-3">
                <label for="goal" class="form-label">Goal</label>
                <select name="goal" id="goal" class="form-select" required>
                    <option value="weight_loss">Weight Loss</option>
                    <option value="muscle_gain">Muscle Gain</option>
                    <option value="maintain">Maintain Weight</option>
                </select>
            </div>

            <div class="mb-3">
                <label for="age" class="form-label">Age</label>
                <input type="number" class="form-control" name="age" id="age" min="10" max="100" required />
            </div>

            <div class="mb-3">
                <label for="weight" class="form-label">Weight (kg)</label>
                <input type="number" class="form-control" name="weight" id="weight" step="0.1" min="20" max="300" required />
            </div>

            <div class="mb-3">
                <label for="height" class="form-label">Height (cm)</label>
                <input type="number" class="form-control" name="height" id="height" step="0.1" min="50" max="250" required />
            </div>

            <div class="mb-3">
                <label for="activityLevel" class="form-label">Activity Level</label>
                <select name="activityLevel" id="activityLevel" class="form-select" required>
                    <option value="sedentary">Sedentary (little or no exercise)</option>
                    <option value="light">Light (1-3 days/week)</option>
                    <option value="moderate">Moderate (3-5 days/week)</option>
                    <option value="active">Active (6-7 days/week)</option>
                    <option value="very_active">Very Active (hard exercise daily)</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary w-100">Calculate</button>

            <div style="display: flex; justify-content: center; margin-top: 30px;">
                <a href="/" class="btn-action" 
                    style="
                    background-color: #16a085; 
                    color: #fff; 
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
                    padding: 12px 30px; 
                    border-radius: 12px; 
                    font-weight: bold; 
                    text-decoration: none; 
                    display: inline-block;
                    width: 120px;
                    text-align: center;
                    transition: background-color 0.3s ease;
                    ">
                    Home
                </a>
            </div>
        </form>

        <div id="resultSection" class="result mt-4" style="display: none;">
            <p><strong>Calories:</strong> <span id="calories">0</span> kcal</p>
            <p><strong>Protein:</strong> <span id="protein">0</span> g</p>
            <p><strong>Fats:</strong> <span id="fats">0</span> g</p>
            <p><strong>Carbs:</strong> <span id="carbs">0</span> g</p>
            <p><strong>BMI:</strong> <span id="bmi">0</span> (<span id="bmiCategory">Unknown</span>)</p>

            <canvas id="macroChart"></canvas>
        </div>
    </div>

    <script>
        document.getElementById('macroForm').addEventListener('submit', function(event) {
            event.preventDefault();
            
            // Get form values
            const goal = document.getElementById('goal').value;
            const age = parseInt(document.getElementById('age').value);
            const weight = parseFloat(document.getElementById('weight').value);
            const height = parseFloat(document.getElementById('height').value);
            const activityLevel = document.getElementById('activityLevel').value;
            
            // Basic BMR calculation (Mifflin-St Jeor Equation for males)
            let bmr = (10 * weight) + (6.25 * height) - (5 * age) + 5;
            
            // Total Daily Energy Expenditure (TDEE) based on activity level
            let tdee = 0;
            switch (activityLevel) {
                case 'sedentary':
                    tdee = bmr * 1.2;
                    break;
                case 'light':
                    tdee = bmr * 1.375;
                    break;
                case 'moderate':
                    tdee = bmr * 1.55;
                    break;
                case 'active':
                    tdee = bmr * 1.725;
                    break;
                case 'very_active':
                    tdee = bmr * 1.9;
                    break;
                default:
                    tdee = bmr;
            }
            
            // Calculate calories based on goals
            let calories = 0;
            if (goal === 'weight_loss') {
                calories = tdee - 500;  // 500-calorie deficit
            } else if (goal === 'muscle_gain') {
                calories = tdee + 500;  // 500-calorie surplus
            } else {
                calories = tdee;
            }
            
            // Macros calculation
            const protein = Math.round(weight * 2.2 * 10) / 10; // Protein in grams (2.2g per kg)
            const fats = Math.round((calories * 0.25) / 9 * 10) / 10; // 25% of calories from fat, convert to grams
            const carbs = Math.round((calories - (protein * 4 + fats * 9)) / 4 * 10) / 10; // Remaining calories from carbs in grams
            
            // Calculate BMI = weight (kg) / height(m)^2
            const heightMeters = height / 100;
            const bmi = Math.round(weight / (heightMeters * heightMeters) * 10) / 10;
            
            // BMI category
            let bmiCategory = '';
            if (bmi < 18.5) {
                bmiCategory = 'Underweight';
            } else if (bmi < 25) {
                bmiCategory = 'Normal weight';
            } else if (bmi < 30) {
                bmiCategory = 'Overweight';
            } else {
                bmiCategory = 'Obese';
            }
            
            // Update the result section
            document.getElementById('calories').textContent = Math.round(calories);
            document.getElementById('protein').textContent = protein;
            document.getElementById('fats').textContent = fats;
            document.getElementById('carbs').textContent = carbs;
            document.getElementById('bmi').textContent = bmi;
            document.getElementById('bmiCategory').textContent = bmiCategory;
            
            // Show the result section
            document.getElementById('resultSection').style.display = 'block';
            
            // Create the chart
            createMacroChart(protein, fats, carbs);
        });
        
        function createMacroChart(protein, fats, carbs) {
            const ctx = document.getElementById('macroChart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (window.macroChart) {
                window.macroChart.destroy();
            }
            
            const data = {
                labels: ['Protein (g)', 'Fats (g)', 'Carbs (g)'],
                datasets: [{
                    data: [protein, fats, carbs],
                    backgroundColor: [
                        '#34a853',  // green for protein
                        '#f4b400',  // yellow for fats
                        '#4285f4'   // blue for carbs
                    ],
                    hoverOffset: 30
                }]
            };
            
            const config = {
                type: 'pie',
                data: data,
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#d1d5db', font: { size: 14, weight: 'bold' } }
                        },
                        tooltip: {
                            enabled: true,
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw + ' g';
                                }
                            }
                        }
                    }
                }
            };
            
            window.macroChart = new Chart(ctx, config);
        }
    </script>
</body>
</html>